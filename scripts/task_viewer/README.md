# Task Viewer

Task Viewer is a standalone Flask application for displaying and comparing XCTrack task metadata and GeoJSON visualizations. This tool is designed for testing purposes to compare data generated by [tools.xcontest.org/xctsk/](https://tools.xcontest.org/xctsk/) with data generated by the [`pyxctsk`](../../src/pyxctsk/) project.

---

## Features

- Browse available task files from your downloaded_tasks directory
- Visualize task routes and turnpoints on an interactive map
- View detailed task metadata and turnpoint information
- Compare task representation between different formats (JSON and GeoJSON)
- Calculate task distances using the XCTrack and AirScore algorithm implementations
- API endpoints for programmatic access to task data

## Project Structure

```plaintext
.
├── app.py                   # Main Flask application entry point
├── README.md                # Project documentation (this file)
├── airscore_utils.py        # Core AirScore utilities
├── api.py                   # API endpoints for programmatic access
├── shared.py                # Shared utilities and constants
├── airscore_clone/          # AirScore-compatible modules and algorithms
├── static/
│   └── style.css            # Custom CSS styles
└── templates/               # Jinja2 HTML templates
    ├── airscore_view.html   # AirScore results view
    ├── base.html            # Base template
    ├── compare_view.html    # Task comparison view
    ├── debug_view.html      # Debugging view
    ├── index.html           # Task list template
    └── task_view.html       # Task visualization template
```

## Setup

- Create and activate a virtual environment:

```bash
python -m venv .venv
source .venv/bin/activate  # Use .venv/bin/activate.fish for fish shell
# Or activate a .venv from another location:
source /path/to/your/.venv/bin/activate

source /home/simon/git/pyxctsk/.venv/bin/activate
source /Users/simon/DEV/git/pyxctsk/.venv/bin/activate
```

- Install required dependencies:

```bash
pip install flask
# And any other dependencies listed in pyproject.toml
```

## Usage

### Running the Application

To start the task viewer application:

```bash
cd scripts/task_viewer
python app.py
```

This will start a development server on <http://localhost:5001>.

### Task Data Requirements

Task data files are expected in the following locations:

- JSON files: `scripts/downloaded_tasks/json/` (`JSON_DIR`)
- GeoJSON files: `scripts/downloaded_tasks/geojson/` (`GEOJSON_DIR`)
- XCTrack task files: `scripts/downloaded_tasks/xctsk/` (`XCTSK_DIR`)

All files for a given task should share the same base name (e.g., `task_name.json`, `task_name.geojson`, `task_name.xctsk`).

## Comparing with XCTrack Generated Data

This tool allows side-by-side comparison between:

1. Task data downloaded from xcontest (stored in downloaded_tasks)
2. Task data generated by pyxctsk

Use this to validate:

- Correct parsing of task files
- Accurate calculation of distances
- Proper representation of turnpoints and routes

## API Endpoints

The application provides several API endpoints for programmatic access to task data and related resources:

### `GET /api/task/<task_name>`

Returns a JSON object with the task's metadata and GeoJSON representation for the specified task.

---

### `GET /api/kml/<task_name>.kml`

Returns a KML file for the specified task, suitable for download and use in mapping applications.

---

### `GET /api/compare/<task_name>`

Returns a JSON object comparing the original task data with data generated by pyxctsk, including distance calculations and GeoJSON representations.

---

### `GET /api/list_tasks`

Returns a JSON list of available task base names (without file extensions).

---

All endpoints return error messages in JSON format with appropriate HTTP status codes if a resource is not found or an error occurs.

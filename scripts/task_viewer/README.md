# XCTrack Task Viewer

A standalone Flask application for displaying and comparing XCTrack task metadata and GeoJSON visualizations. This tool is designed for testing purposes to compare data generated by xcontest with data generated by the python-xctrack project.

## Features

- Browse available task files from your downloaded_tasks directory
- Visualize task routes and turnpoints on an interactive map
- View detailed task metadata and turnpoint information
- Compare task representation between different formats (JSON and GeoJSON)
- Calculate task distances using the XCTrack algorithm implementation
- Calculate task distances using the AirScore algorithm implementation
- API endpoints for programmatic access to task data

## Directory Structure

```sh
task_viewer/
├── app.py                  # Main Flask application
├── README.md               # This file
├── airscore_utils.py       # Utilities for AirScore distance calculations
├── static/
│   └── style.css          # Custom CSS styles
└── templates/
    ├── index.html         # Task list template
    └── task_view.html     # Task visualization template
```

## Setup

1. Create and activate a virtual environment:

```bash
python -m venv venv
source venv/bin/activate  # Use venv/bin/activate.fish for fish shell
source /home/simon/git/python-xctrack/venv/bin/activate
```

2. Install required dependencies:

```bash
pip install flask
```

## Usage

### Running the Application

To start the task viewer application:

```bash
cd scripts/task_viewer
python app.py
```

This will start a development server on <http://localhost:5001>.

### Viewing Tasks

1. Navigate to <http://localhost:5001> in your browser
2. Click on any task from the list to view its details
3. Use the tabs to switch between:
   - Metadata overview
   - Turnpoints list
   - Raw JSON data
   - Raw GeoJSON data

### Task Data Requirements

The application expects:

- Task JSON files in `scripts/downloaded_tasks/json/`
- Task GeoJSON files in `scripts/downloaded_tasks/geojson/`

Both files should share the same base name (e.g., `task_name.json` and `task_name.geojson`).

## Task File Format

### JSON Structure

The JSON files should follow this basic structure:

```json
{
  "metadata": {
    "file_name": "task_name",
    "created": "2025-06-16 13:49:26 UTC",
    "author": "Author Name",
    "start_type": "Race",
    "sss_open": "17:00 (UTC)",
    "goal_type": "CYLINDER",
    "task_deadline": "22:00 (UTC)",
    "earth_model": "WGS84 ellipsoid",
    "task_distance_through_centers": "128.7km (through centers)",
    "task_distance_optimized": "94.1km (optimized)",
    "distance_through_centers_km": 128.7,
    "distance_optimized_km": 94.1
  },
  "turnpoints": [
    {
      "#": 1,
      "Name": "D02",
      "Radius (m)": 400,
      "Distance (km)": 0.0,
      "Optimized (km)": 0.0,
      "Type": "Takeoff"
    },
    // Additional turnpoints...
  ]
}
```

### GeoJSON Structure

The GeoJSON files should include:

- An optimized route line feature with type "optiline"
- Turnpoint cylinder features with appropriate properties (name, radius, type, etc.)

## Comparing with XCTrack Generated Data

This tool allows side-by-side comparison between:

1. Task data downloaded from xcontest (stored in downloaded_tasks)
2. Task data generated by the python-xctrack project

Use this to validate:

- Correct parsing of task files
- Accurate calculation of distances
- Proper representation of turnpoints and routes

## API Access

The application provides a simple API endpoint to access task data programmatically:

`GET /api/task/<task_name>`

This returns a JSON object with the task's metadata, turnpoints, and GeoJSON representation.
